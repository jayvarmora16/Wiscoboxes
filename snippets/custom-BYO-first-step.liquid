<style>
  .product-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #dce0e0;
  }
  .image-title {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
    margin-left: 10px;
  }
  .row-image {
    background-position: 50%;
    background-repeat: no-repeat;
    background-size: contain;
    /* display: block; */
    /* padding-top: 100%; */
    width: 80px;
    box-sizing: border-box;
    line-height: normal;
    height: 80px;
    margin-top: -18px;
    margin-right: 10px;
  }
  .row-title h3 {
    font-size: 0.7em;
    font-weight: 400;
    margin-bottom: -0.5em;
  }
  .row-title p {
    font-size: 0.8em;
    font-weight: 300;
  }
  .close-button {
    background: #fff;
    border-radius: var(--gs-border-radius, 0.28571429rem);
    color: silver;
    height: 25px;
    margin-left: 1em;
    padding: 0;
    transition: all 0.25s ease;
    width: 20px;
    margin-right: 1em;
    align-items: center;
    margin-top: 4px;
    cursor: pointer;
  }
  .plus,
  .minus {
    background: #fff;
    border: 1px solid #f0f0f0;
    color: #000;
    box-shadow: none;
    align-items: center;
    display: flex;
    font-size: 14px;
    height: 31px;
    justify-content: center;
    justify-self: end;
    width: 22px;
  }
  .row-quantity {
    display: flex;
  }
  .row-input {
    width: 50px;
    height: 27px;
    text-align: center;
    border: 1px solid #f0f0f0;
  }
  .quantity-close {
    display: flex;
    justify-content: center;
  }

</style>

<section id="gsBuilderItems" class="gs__selected-items">
  <div class="gs__item-main-content">
    <h2 class="gs__item-main-content-heading">Box Contents</h2>
    <div class="loader1"></div>
  </div>
  <div class="gs__item-sidebar">
    <div class="gs__box-summary">
      <h2 class="gs__box-summary-header">Box Summary</h2>
      <div class="gs__box-sizes">
        <div class="gs__box-size-row gs__current-box-size">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 133" class="gs__box-preview-svg" fill="currentColor">
            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Package_Opened" transform="translate(1.000000, 1.000000)"><path d="M18.4,36.1 L1.6,19.7 C0.1,18.2 0.8,15.6 2.9,15.1 L58.9,1 C60.4,0.6 61.9,1.2 62.9,2.3 L77.2,20.1 L18.4,36.1" id="Shape" fill="#FFFFFF" fill-rule="nonzero"></path><path d="M18.4,36.1 L4.1,22.9 C2.6,21.4 3.3,18.8 5.4,18.3 L57.4,5 C58.9,4.6 60.4,5.2 61.4,6.3 L73.2,20.9 L18.4,36.1" id="Shape" fill="#DDECFE" fill-rule="nonzero"></path><path d="M18.4,36.1 L77.6,47.3 L77.9,130.2 L18.5,114.4 C18.5,114.4 18.9,36.1 18.4,36.1 Z" id="Shape" fill="#FFFFFF" fill-rule="nonzero"></path><path d="M134.4,32.9 L77.6,47.4 L77.9,130.3 L134.6,110.5 C134.6,110.5 133.9,32.9 134.4,32.9 Z" id="Shape" fill="#FFFFFF" fill-rule="nonzero"></path><path d="M21.7,39.9 L79.2,50.7 L79.5,130.3 L21.9,115.1 C21.9,115.1 22.2,39.9 21.7,39.9 Z" id="Shape" fill="#DDECFE" fill-rule="nonzero"></path><path d="M134.6,111.3 L79.5,130.3 L79.2,54.7 L79.2,50.8 L134.4,36.9 C134.2,36.9 134.2,51.3 134.3,67.4 C134.4,87.9 134.6,111.3 134.6,111.3 Z" id="Shape" fill="#DDECFE" fill-rule="nonzero"></path><path d="M134.3,61.7 L87.7,74.8 C85.7,75 83.9,73.8 83.3,71.8 L79.3,54.7 L79.3,50.8 L134.5,36.9 C134.2,36.8 134.2,45.6 134.3,61.7 Z" id="Shape" fill="#B8D9FF" fill-rule="nonzero"></path><path d="M77.8,92.6 L77.9,130.3 L18.5,114.5 C18.5,114.5 18.8,36.2 18.3,36.2 L77.5,47.4" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M77.7,72.1 L77.7,84.3" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M134.2,55.4 C134.2,42.7 134.2,32.9 134.4,32.9 L77.7,47.3" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M77.8,101.2 L77.9,130.3 L134.6,110.5 C134.6,110.5 134.4,84.9 134.3,63.1" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><polygon id="Shape" fill="#FFFFFF" fill-rule="nonzero" points="18.4 36.1 77.2 20.1 134.4 32.9 77.6 47.3"></polygon><polygon id="Shape" fill="#99C7FF" fill-rule="nonzero" points="27.7 37 77 23.1 129.6 34.9 82.1 47.3"></polygon><polyline id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="96.4 24.4 134.4 32.9 77.6 47.3 18.4 36.1 77.2 20.1 84.5 21.8"></polyline><path d="M87.7,22.5 L89,22.8" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M18.4,36.1 L1.6,19.7 C0.1,18.2 0.8,15.6 2.9,15.1 L58.9,1 C60.4,0.6 61.9,1.2 62.9,2.3 L77.2,20.1 L18.4,36.1" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M134.4,32.9 L147.7,49 C149,50.7 148.2,53.1 146.2,53.7 L98.8,67.6 C97.3,68 95.8,67.5 94.8,66.4 L77.6,47.4 L134.4,32.9 Z" id="Shape" fill="#FFFFFF" fill-rule="nonzero"></path><path d="M133.6,36.1 L144.4,49.8 C145.7,51.5 144.9,53.9 142.9,54.5 L98.7,67.6 C97.2,68 95.7,67.5 94.7,66.4 L79.9,49.8 L133.6,36.1 Z" id="Shape" fill="#DDECFE" fill-rule="nonzero"></path><path d="M134.4,32.9 L147.7,49 C149,50.7 148.2,53.1 146.2,53.7 L98.8,67.6 C97.3,68 95.8,67.5 94.8,66.4 L77.6,47.4 L134.4,32.9 Z" id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path><path d="M77,34.2 L77,47.2" id="Shape" stroke="#1676EE" stroke-width="3" fill="#DDECFE" fill-rule="nonzero" stroke-linecap="round" stroke-linejoin="round"></path><path d="M77,25.4 L77,29.4" id="Shape" stroke="#1676EE" stroke-width="3" fill="#DDECFE" fill-rule="nonzero" stroke-linecap="round" stroke-linejoin="round"></path><polygon id="Shape" fill="#FFFFFF" fill-rule="nonzero" points="50.8 77.7 29.2 72.8 29.2 57.9 50.8 62.8"></polygon><polygon id="Shape" fill="#99C7FF" fill-rule="nonzero" points="50.8 77.7 31.4 73.6 31.4 61 50.3 65.4"></polygon><polygon id="Shape" stroke="#1676EE" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="50.8 77.7 29.2 72.8 29.2 57.9 50.8 62.8"></polygon></g></g>
          </svg>
          <p class="gs__box-name"></p>
          <p class="gs__box-price"></p>
        </div>
      </div>
      <div class="gs__box-summary-footer">
        <p class="gs__box-total">Total: <span class="total-price"></span></p>
      </div>
    </div>
    <div class="gs__nav-buttons">
      <div class="dot-container">
        <div class="dot dark"></div>
        <div class="dot light"></div>
      </div>
      <div class="gs__nav-buttons-container">
        <button class="next-button" type="button">Next</button>
      </div>
    </div>
  </div>
</section>
{% comment %}
  <script>
     function formatPrice(priceInCents) {
        return `$${(priceInCents / 100).toFixed(2)}`;
      }
      function removeProductFromLocalStorage(productId) {
        localStorage.removeItem('product-' + productId);
      }
    function createProductRow(productImage, productTitle, productPrice, productQuantity, productId) {
        var productRow = document.createElement('div');
        productRow.setAttribute('class', 'product-row');
        productRow.setAttribute('data-product-id', productId);
        var formattedPrice = formatPrice(productPrice);
        productRow.innerHTML = `
              <div class="image-title">
                  <div class="row-image" style="background-image: url('${productImage}');"></div>
                  <div class="row-title">
                      <h3>${productTitle}</h3>
                      <p>${formattedPrice}</p>
                  </div>
              </div>
              <div class="quantity-close">
                  <div class="row-quantity">
                      <button class="plus">+</button>
                      <input value="${productQuantity}" class="row-input">
                      <button class="minus">-</button>
                  </div>
                  <div class="close-button"><svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 512 512"
              class="gs__btn-delete-item-svg"
              fill="currentColor"
            >
              <path d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"></path>
            </svg></div>
              </div>
          `;

        // Event listeners for quantity buttons and input field
        var plusButton = productRow.querySelector('.plus');
        var minusButton = productRow.querySelector('.minus');
        var quantityInput = productRow.querySelector('.row-input');

        plusButton.addEventListener('click', function () {
          quantityInput.value = parseInt(quantityInput.value) + 1;
          updateLocalStorage(productId, quantityInput.value);
        });

        minusButton.addEventListener('click', function () {
          if (parseInt(quantityInput.value) > 1) {
            quantityInput.value = parseInt(quantityInput.value) - 1;
            updateLocalStorage(productId, quantityInput.value);
          }
        });

        quantityInput.addEventListener('change', function () {
          if (parseInt(quantityInput.value) < 1) {
            quantityInput.value = 1; // Minimum quantity should be 1
          }
          updateLocalStorage(productId, quantityInput.value);
        });

        return productRow;
      }
      function updateLocalStorage(productId, productQuantity) {
        var productDetails = JSON.parse(localStorage.getItem('product-' + productId));
        if (productDetails) {
          productDetails.quantity = productQuantity;
          localStorage.setItem('product-' + productId, JSON.stringify(productDetails));
        }
      }
      function initializeCart() {
        var cartContainer = document.querySelector('.gs__item-main-content');
          for (var i = 0; i < localStorage.length; i++) {
              var key = localStorage.key(i);
              // Check if the key corresponds to a product entry
              if (key.startsWith('product-')) {
                  var productDetails = JSON.parse(localStorage.getItem(key));
                  if (productDetails) {
                      var productRow = createProductRow(
                          productDetails.image,
                          productDetails.title,
                          productDetails.price,
                          productDetails.quantity,
                          productDetails.id
                      );
                      cartContainer.appendChild(productRow);
                  }
              }
          }

          // Attach remove event listeners to all close buttons after cart initialization
          attachRemoveEventListeners();
      }
      function attachRemoveEventListeners() {
          const closeButtons = document.querySelectorAll('.close-button');
          closeButtons.forEach(function(button) {
              button.addEventListener('click', function() {
                  var productRow = this.closest('.product-row');
                  if (productRow) {
                      var productIdToRemove = productRow.getAttribute('data-product-id');
                      productRow.remove(); // Remove the product row from the DOM
                      removeProductFromLocalStorage(productIdToRemove); // Update: Remove the product from local storage as well
                  }
              });
          });
      }

      // Call the initialize function on page load to populate the cart from local storage
      initializeCart();

  </script>
{% endcomment %}
<style>
  .next-button:hover {
    background-color: #ededed;
  }
  .gs__nav-buttons {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  .gs__nav-buttons-container {
    width: 95%;
  }
  .dot-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 50%;
    margin-top: 12px;
  }

  .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin: 0 10px;
  }

  .dark {
    background-color: #000000; /* Dark color */
  }

  .light {
    background-color: #cccccc; /* Light color */
  }
  .next-button {
    background: #9b2743;
    min-height: 50px;
    color: #fff;
    border: 1px solid var(--gs-brand-color, #000);
    flex: 1;
    font-size: 1em;
    margin-top: 0;
    padding: 0.55em 0;
    width: 100%;
    margin-top: 10px;
    margin-bottom: 10px;
  }
  #gsBuilderItems {
    background: #fff;
    display: flex;
    justify-content: center;
    width: 100%;
  }
  .gs__item-main-content {
    display: block;
    overflow: auto;
    width: 65%;
  }
  .gs__item-main-content-heading {
    background: #fcfcfc;
    border-bottom: 1px solid var(--gs-border-color, #ededed);
    font-size: 1em;
    font-weight: 400;
    padding: 0.8em;
    position: sticky;
    text-align: center;
    box-sizing: border-box;
    line-height: normal;
  }
  .gs__item-sidebar {
    border-left: 1px solid #f0f0f0;
    display: grid;
    grid-template-rows: 1fr auto;
    vertical-align: bottom;
    width: 35%;
  }
  .gs__box-summary {
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    flex-direction: column;
  }
  .gs__box-summary-header {
    background: #fcfcfc;
    border-bottom: 1px solid var(--gs-border-color, #ededed);
    font-size: 0.9em;
    font-weight: 400;
    padding: 0.8em;
    position: sticky;
    text-align: center;
  }
  .gs__box-sizes {
    align-items: center;
    height: 100%;
    padding: 0em 1.5em;
  }
  .gs__box-size-row {
    display: grid;
    font-size: 1em;
    font-weight: 400;
    gap: 2em;
    grid-auto-rows: 1fr;
    grid-template-columns: 2em 1fr auto;
    grid-template-rows: 1fr;
    color: rgba(0, 0, 0, 0.5);
  }
  .gs__box-sizes .gs__box-size-row .gs__box-preview-svg {
    aspect-ratio: 1;
    width: 100%;
  }
  .gs__box-summary .gs__box-summary-footer {
    background: #fcfcfc;
    border-top: 1px solid #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5em;
    justify-content: space-between;
    padding: 0.3em 1.5em;
  }
  .gs__box-summary-footer p {
    font-weight: 600;
    font-size: 1em;
    text-align: center;
    margin: 0;
  }
  .gs__box-summary .gs__box-sizes .gs__box-size-row .gs__box-name {
    align-self: center;
    text-align: start;
  }
  .gs__box-summary .gs__box-sizes .gs__box-size-row p {
    align-self: center;
  }
</style>
